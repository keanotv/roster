import{e as d,c as u,y as le,f as l,d as ne,u as he,w as Q,b$ as ge,r as V,c0 as v,o as ke,z as ye,F as N,h as a,i as s,c1 as be,K as we,b as r,A as _,c2 as M,j as R,t as w,a as A,k as z,l as ee,c3 as Ce,c4 as xe,c5 as Re,bW as te,bX as D,bY as ae,bZ as se,c6 as Ee,c7 as Ve,B as oe,b_ as Be,c8 as Se,X as $e,C as Le,c9 as Ne,ca as Me,cb as De,cc as Oe,cd as Te,ce as Ie,_ as Ae,p as ze,m as Ue}from"./index.59c36499.js";import{_ as Pe}from"./delete-outline.32835710.js";const je={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ye=le('<g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><g stroke-dasharray="12" stroke-dashoffset="12"><path d="M12 7V17"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.8s" dur="0.2s" values="12;0"></animate></path><path d="M7 12H17"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="12;0"></animate></path></g><path stroke-dasharray="60" stroke-dashoffset="60" d="M3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"></animate></path></g>',1),He=[Ye];function Fe(g,k){return d(),u("svg",je,[...He])}var Ge={name:"line-md-plus-circle",render:Fe};const We={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Xe=le('<g fill="none" stroke="currentColor" stroke-dasharray="18" stroke-dashoffset="18" stroke-linecap="round" stroke-width="2"><path d="M12 5V19"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.4s" dur="0.3s" values="18;0"></animate></path><path d="M5 12H19"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="18;0"></animate></path></g>',1),Ze=[Xe];function Je(g,k){return d(),u("svg",We,[...Ze])}var Ke={name:"line-md-plus",render:Je};const qe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Qe=l("path",{stroke:"currentColor","stroke-dasharray":"18","stroke-dashoffset":"18","stroke-linecap":"round","stroke-width":"2",d:"M5 12H19",fill:"currentColor"},[l("animate",{fill:"freeze",attributeName:"stroke-dashoffset",dur:"0.3s",values:"18;0"})],-1),et=[Qe];function tt(g,k){return d(),u("svg",qe,[...et])}var at={name:"line-md-minus",render:tt};const st={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ot=l("g",{transform:"translate(24 0) scale(-1 1)"},[l("path",{fill:"none",stroke:"currentColor","stroke-dasharray":"10","stroke-dashoffset":"10","stroke-linecap":"round","stroke-width":"2",d:"M8 12L15 5M8 12L15 19"},[l("animate",{fill:"freeze",attributeName:"stroke-dashoffset",dur:"0.3s",values:"10;0"})])],-1),lt=[ot];function nt(g,k){return d(),u("svg",st,[...lt])}var rt={name:"line-md-chevron-right",render:nt};const it={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},dt=l("path",{fill:"none",stroke:"currentColor","stroke-dasharray":"10","stroke-dashoffset":"10","stroke-linecap":"round","stroke-width":"2",d:"M8 12L15 5M8 12L15 19"},[l("animate",{fill:"freeze",attributeName:"stroke-dashoffset",dur:"0.3s",values:"10;0"})],-1),ut=[dt];function ct(g,k){return d(),u("svg",it,[...ut])}var vt={name:"line-md-chevron-left",render:ct};const _t={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},mt=l("path",{fill:"currentColor",d:"M19 15.59L17.59 17L14 13.41L10.41 17L9 15.59L12.59 12L9 8.41L10.41 7L14 10.59L17.59 7L19 8.41L15.41 12L19 15.59M22 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H7c-.69 0-1.23-.36-1.59-.89L0 12l5.41-8.12C5.77 3.35 6.31 3 7 3h15m0 2H7l-4.72 7L7 19h15V5Z"},null,-1),pt=[mt];function ft(g,k){return d(),u("svg",_t,[...pt])}var ht={name:"mdi-clear-outline",render:ft};const gt={class:"my-2 flex"},kt={class:"my-3 flex justify-between"},yt={class:"flex place-items-center"},bt=l("span",{class:"ml-1 mr-2 font-bold text-sm"},"LIVE",-1),wt={class:"flex place-items-center"},Ct=l("span",{class:"ml-3 mr-2 font-bold text-sm"},"ARCHIVE",-1),xt={class:"my-2"},Rt={class:"mb-3 flex justify-between"},Et={class:"flex justify-between"},Vt={class:"font-bold my-auto"},Bt={class:"flex my-auto"},St={class:"my-1"},$t={class:"flex my-1"},Lt={class:"w-100 flex justify-between"},Nt={class:"text-xs"},Mt={key:1},Dt={class:"text-justify"},Ot={class:"mt-4 flex justify-between"},Tt=ne({__name:"Roster",props:{id:{}},async setup(g){let k,$;const U=g,i=he();!i.unavailability.length||!i.people.length?([k,$]=Q(()=>i.getUnavailability()),await k,$(),[k,$]=Q(()=>i.getPeople()),await k,$()):(!i.unavailabilityByDate.length||!!i.unavailabilityByDate[0])&&ge();const e=V(i.getRosterById(U.id)),L=V("");e.value!==void 0&&(L.value=e.value.date||"");const C=V(!1),m=V(v.SAVE),B=V(""),P=V(-1),Y=n=>{var t;(t=e.value.unsavedRoster)==null||t.splice(n,0,Re()),O()},re=async()=>{switch(m.value){case v.SAVE:e.value.unsavedRoster!=null&&await i.saveRoster(e.value.id,e.value.unsavedRoster);break;case v.COPY:e.value.unsavedRoster!=null&&await Ve(e.value.title,JSON.stringify(e.value.unsavedRoster)).then(n=>{n!==null&&te.push(D(ae.ROSTER)+D(se.VIEW)+D(n.toString()))});break;case v.SYNC:await Ee(e.value.id).then(()=>{const n=i.rosters.find(t=>t.id===e.value.id);n!=null&&n.roster!=null&&(e.value.unsavedRoster=JSON.parse(n.roster))});break;case v.DELETE:await i.deleteRoster(e.value.id).then(()=>{te.push(D(ae.ROSTER)+D(se.VIEW))});break;case v.DELETE_ROLE:e.value.unsavedRoster=e.value.unsavedRoster.filter(n=>n.order!=P.value),P.value=-1,O();break;default:console.log("Action not found for "+m.value);break}C.value=!1},b=V(new Map);ke(()=>{var n;i.people.forEach(t=>{b.value.set(t.id,new Set)}),(n=e.value.unsavedRoster)==null||n.forEach(t=>{t.services.forEach(c=>{c.slot.forEach(S=>{var E;(E=b.value.get(S.id))==null||E.add(t.order)})})})});const ie=(n,t)=>{var c;(c=b.value.get(n))==null||c.add(t)},H=(n,t)=>{var c;(c=b.value.get(n))==null||c.delete(t)},O=()=>{var t;let n=1;(t=e.value.unsavedRoster)==null||t.forEach(c=>{c.order=n,n++})};return ye(async()=>{var n;e.value.id!==U.id&&(e.value=i.getRosterById(U.id),b.value=new Map,i.people.forEach(t=>{b.value.set(t.id,new Set)}),(n=e.value.unsavedRoster)==null||n.forEach(t=>{t.services.forEach(c=>{c.slot.forEach(S=>{var E;(E=b.value.get(S.id))==null||E.add(t.order)})})}))}),(n,t)=>{const c=oe,S=Be,E=oe,de=ht,ue=Se,F=$e,p=Le,T=Ne,ce=Me,j=be,G=vt,ve=Pe,W=rt,_e=at,me=Ke,X=De,pe=Oe,Z=Te,J=Ie,K=Ge,fe=we;return d(),u("div",null,[e.value!==void 0&&e.value.roster!==null?(d(),u(N,{key:0},[a(j,{style:{"--bs-gutter-x":"0"},class:"mb-3"},{default:s(()=>[a(S,{prepend:"Title"},{default:s(()=>[a(c,{modelValue:e.value.title,"onUpdate:modelValue":t[0]||(t[0]=o=>e.value.title=o),onChange:t[1]||(t[1]=o=>{r(i).saveTitle(e.value.id,o.target.value)})},null,8,["modelValue"])]),_:1}),l("div",gt,[l("div",null,[a(S,{prepend:"Date"},{append:s(()=>[a(ue,null,{default:s(()=>[l("div",{onClick:t[4]||(t[4]=()=>{L.value!=""&&(e.value.date="",r(i).saveDate(e.value.id,e.value.date),L.value="")})},[a(de)])]),_:1})]),default:s(()=>[a(E,{onBlur:t[2]||(t[2]=o=>{L.value!=o.target.value&&(r(i).saveDate(e.value.id,o.target.value||""),L.value=o.target.value)}),modelValue:e.value.date,"onUpdate:modelValue":t[3]||(t[3]=o=>e.value.date=o),type:"date"},null,8,["modelValue"])]),_:1})])]),l("div",kt,[l("div",yt,[bt,a(F,{class:"mb-1",modelValue:e.value.published,"onUpdate:modelValue":t[5]||(t[5]=o=>e.value.published=o),disabled:e.value.date===null,switch:"",onClick:t[6]||(t[6]=o=>r(i).updatePublished(e.value.id,!e.value.published))},null,8,["modelValue","disabled"])]),l("div",wt,[Ct,a(F,{class:"mb-1",modelValue:e.value.archived,"onUpdate:modelValue":t[7]||(t[7]=o=>e.value.archived=o),switch:"",onClick:t[8]||(t[8]=o=>r(i).updateArchived(e.value.id,!e.value.archived))},null,8,["modelValue"])])]),l("div",xt,[a(ce,{class:"justify-between"},{default:s(()=>[l("div",null,[a(T,null,{default:s(()=>[a(p,{class:"capitalize",onClick:t[9]||(t[9]=_(()=>{m.value=r(v).SAVE,B.value=r(M).get(m.value),C.value=!0},["prevent"])),variant:"success"},{default:s(()=>[R(w(r(v).SAVE),1)]),_:1})]),_:1}),a(T,{class:"mx-2"},{default:s(()=>[a(p,{class:"capitalize",onClick:t[10]||(t[10]=_(()=>{m.value=r(v).COPY,B.value=r(M).get(m.value),C.value=!0},["prevent"])),variant:"primary"},{default:s(()=>[R(w(r(v).COPY),1)]),_:1})]),_:1})]),l("div",null,[a(T,{class:"mx-2"},{default:s(()=>[a(p,{class:"capitalize",onClick:t[11]||(t[11]=_(()=>{m.value=r(v).SYNC,B.value=r(M).get(m.value),C.value=!0},["prevent"])),variant:"warning"},{default:s(()=>[R(w(r(v).SYNC),1)]),_:1})]),_:1}),a(T,null,{default:s(()=>[a(p,{class:"capitalize",onClick:t[12]||(t[12]=_(()=>{m.value=r(v).DELETE,B.value=r(M).get(m.value),C.value=!0},["prevent"])),variant:"danger"},{default:s(()=>[R(w(r(v).DELETE),1)]),_:1})]),_:1})])]),_:1})])]),_:1}),a(j,{class:"my-4",style:{"--bs-gutter-x":"0"}},{default:s(()=>[a(J,{cols:"1","cols-sm":"2","cols-md":"3","cols-xl":"4","cols-xxl":"5",style:{"--bs-gutter-x":"0"}},{default:s(()=>[(d(!0),u(N,null,A(e.value.unsavedRoster,(o,y)=>(d(),z(Z,{key:y,style:{border:"1px solid currentColor","margin-right":"-1px","margin-bottom":"-1px"},class:"p-2"},{default:s(()=>[l("div",Rt,[y!=0?(d(),z(p,{key:0,onClick:_(()=>{const f=e.value.unsavedRoster[y];e.value.unsavedRoster[y]=e.value.unsavedRoster[y-1],e.value.unsavedRoster[y-1]=f,O()},["prevent"]),class:"border-none px-0.5 mr-0.5"},{default:s(()=>[a(G,{class:"my-auto w-6 h-6"})]),_:2},1032,["onClick"])):ee("",!0),a(c,{class:"font-bold text-md text-center w-100 mx-0.5 px-0",modelValue:o.title,"onUpdate:modelValue":f=>o.title=f,state:o.title.length?null:!1},null,8,["modelValue","onUpdate:modelValue","state"]),a(p,{onClick:_(()=>{m.value=r(v).DELETE_ROLE,B.value=r(M).get(m.value).concat(o.title.length?o.title:"(empty)"),P.value=o.order,C.value=!0},["prevent"]),variant:"danger",class:"px-1 mx-0.5"},{default:s(()=>[a(ve,{class:"my-auto w-5 h-5"})]),_:2},1032,["onClick"]),y!=e.value.unsavedRoster.length-1?(d(),z(p,{key:1,onClick:_(()=>{const f=e.value.unsavedRoster[y];e.value.unsavedRoster[y]=e.value.unsavedRoster[y+1],e.value.unsavedRoster[y+1]=f,O()},["prevent"]),class:"border-none px-0.5 ml-0.5"},{default:s(()=>[a(W,{class:"my-auto w-6 h-6"})]),_:2},1032,["onClick"])):ee("",!0)]),a(j,{style:{"--bs-gutter-x":"0"}},{default:s(()=>[(d(!0),u(N,null,A(o.services,f=>(d(),u("div",null,[a(J,{cols:"1",style:{"--bs-gutter-x":"0"}},{default:s(()=>[l("div",Et,[l("p",Vt,w(r(Ce).get(f.no))+" Service ",1),l("div",Bt,[a(p,{onClick:_(()=>{f.slot.length>1&&f.slot.pop()},["prevent"]),style:{"padding-top":"0.15rem","padding-bottom":"0.15rem"},class:"px-1.5 mx-1.5"},{default:s(()=>[a(_e,{class:"w-4"})]),_:2},1032,["onClick"]),a(p,{onClick:_(()=>{f.slot.length<5&&f.slot.push(new(r(xe))(f.slot.length+1))},["prevent"]),style:{"padding-top":"0.15rem","padding-bottom":"0.15rem"},class:"px-1.5"},{default:s(()=>[a(me,{class:"w-4"})]),_:2},1032,["onClick"])])]),l("div",St,[(d(!0),u(N,null,A(f.slot,h=>(d(),u("div",$t,[a(c,{modelValue:h.segments,"onUpdate:modelValue":I=>h.segments=I,class:"w-14 mr-2 px-1 text-center"},null,8,["modelValue","onUpdate:modelValue"]),a(Z,null,{default:s(()=>{var I;return[a(pe,{lazy:"","no-flip":"",text:h.name,variant:(I=r(i).unavailabilityByDate[0].get(e.value.date||""))!=null&&I.has(h.id)?"danger":b.value.get(h.id)!==void 0&&b.value.get(h.id).size>1?"warning":"dark"},{default:s(()=>[a(X,{variant:"secondary",onClick:_(()=>{H(h.id,o.order),h.name="",h.id=0},["prevent"])},{default:s(()=>[R(w("<empty>"))]),_:2},1032,["onClick"]),(d(!0),u(N,null,A(r(i).people.filter(x=>x.active),x=>{var q;return d(),z(X,{variant:(q=r(i).unavailabilityByDate[0].get(e.value.date||""))!=null&&q.has(x.id)?"danger":b.value.get(x.id).size>0?"warning":"dark",onClick:_(()=>{h.id!==0&&H(h.id,o.order),h.name=x.name,h.id=x.id,ie(x.id,o.order)},["prevent"])},{default:s(()=>[R(w(x.name),1)]),_:2},1032,["variant","onClick"])}),256))]),_:2},1032,["text","variant"])]}),_:2},1024)]))),256))])]),_:2},1024)]))),256)),l("div",Lt,[a(p,{onClick:_(()=>Y(o.order-1),["prevent"]),class:"border-none pl-1 pr-1.5"},{default:s(()=>[a(G,{class:"my-auto w-6 h-6 inline"}),a(K,{class:"my-auto w-6 h-6 inline"})]),_:2},1032,["onClick"]),a(p,{onClick:_(()=>Y(o.order),["prevent"]),class:"border-none pl-1.5 pr-1"},{default:s(()=>[a(K,{class:"my-auto w-6 h-6 inline"}),a(W,{class:"my-auto w-6 h-6 inline"})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),l("span",Nt,"Created at: "+w(new Date(Date.parse(e.value.created_at)).toLocaleString("en-SG",{dateStyle:"medium",timeStyle:"short"})),1)]),_:1})],64)):(d(),u("div",Mt,"Roster does not exist!")),a(fe,{centered:"","hide-footer":"","hide-header":"",modelValue:C.value,"onUpdate:modelValue":t[14]||(t[14]=o=>C.value=o)},{default:s(()=>[l("p",Dt,w(B.value),1),l("div",Ot,[a(p,{onClick:_(re,["prevent"]),variant:"primary",class:"capitalize"},{default:s(()=>[R(w(m.value),1)]),_:1}),a(p,{onClick:t[13]||(t[13]=_(o=>C.value=!1,["prevent"]))},{default:s(()=>[R("Cancel")]),_:1})])]),_:1},8,["modelValue"])])}}});const It=g=>(ze("data-v-a1f7abc8"),g=g(),Ue(),g),At={id:"edit-roster",class:"my-8 mx-4"},zt=It(()=>l("h1",{class:"my-2 text-center"},"Roster (Edit)",-1)),Ut=ne({__name:"RosterView",props:{id:{}},setup(g){return(k,$)=>(d(),u("div",At,[zt,a(Tt,{id:Number.parseInt(k.id)},null,8,["id"])]))}});var Yt=Ae(Ut,[["__scopeId","data-v-a1f7abc8"]]);export{Yt as default};
